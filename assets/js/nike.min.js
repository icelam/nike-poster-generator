var nikePosterGenerator=function(){var t=!0,e=!1,a=new Image,i=new Image;i.src="assets/images/just-do-it.svg";var o,n=document.getElementById("canvas"),r=n.getContext("2d",{alpha:!1}),h=function(){if(e){switch(document.getElementById("orientation").value){case"1":n.width=a.width,n.height=a.height,r.transform(1,0,0,1,0,0);break;case"2":n.width=a.height,n.height=a.width,r.transform(0,1,-1,0,a.height,0);break;case"3":n.width=a.width,n.height=a.height,r.transform(-1,0,0,-1,a.width,a.height);break;case"4":n.width=a.height,n.height=a.width,r.transform(0,-1,1,0,0,a.width);break;default:n.width=a.width,n.height=a.height,r.transform(1,0,0,1,0,0)}if(r.clearRect(0,0,n.width,n.height),r.drawImage(a,0,0),r.setTransform(1,0,0,1,0,0),l(r,"saturation"))r.fillStyle="hsl(0,0%,50%)",r.fillRect(0,0,n.width,n.height),r.globalCompositeOperation="source-over";else{r.filter="saturate(0%)";var h=r.getImageData(0,0,n.width,n.height);r.putImageData(h,0,0),r.filter="none"}var s=r.getImageData(0,0,n.width,n.height);s=d(s,document.getElementById("brightness").value,document.getElementById("contrast").value),r.putImageData(s,0,0),r.fillStyle="rgba(0, 0, 0, 0.5)",r.fillRect(0,0,n.width,n.height);var m=i.width/i.height,c=Math.floor(.03*n.width),u=c*m;r.drawImage(i,0,0,i.width,i.height,(n.width-u)/2,Math.floor(n.height-.06*n.height-c),u,c),o=r.getImageData(0,0,n.width,n.height),g(r,n.width,n.height,document.getElementById("slogan").value),t&&(document.getElementById("welcome").style.display="none",n.style.display="block",t=!1)}},l=function(t,e){return t.globalCompositeOperation=e,t.globalCompositeOperation==e},g=function(t,e,a,i){var o=Math.floor(.07*e),n=Math.floor(e/2),r=Math.floor(a/2),h=Math.floor(.9*e),l=Math.floor(1.3*o),g=i.split(" "),s="",d=[];t.font=o+'px Times,"Times New Roman","Microsoft JhengHei","Heiti TC",sans-serif',t.textAlign="center",t.textBaseline="top",t.fillStyle="white";for(var m=0;m<g.length;m++){var c=s+g[m]+" ";t.measureText(c).width>h&&m>0?(d.push(s),s=g[m]+" "):s=c}d.push(s);var u=r-Math.floor(d.length*l/2);for(m=0;m<d.length;m++)t.fillText(d[m].trim(),n,u),u+=l},s=function(t){return t<0?0:t>255?255:t},d=function(t,e,a){for(var i=t.data,o=0,n=i.length;o<n;o+=4)i[o]=m(i[o],e),i[o]=c(i[o],a),i[o+1]=i[o],i[o+2]=i[o];return t.data=i,t},m=function(t,e){return t+e/100*255},c=function(t,e){return t=s(t*(e=e/100+1)+128*(1-e))};return{loadImage:function(){for(var t=document.getElementById("poster-source").files,i=0;i<t.length;i++){var o=t[i];o.type.match(/image.*/)?(a.src=URL.createObjectURL(o),a.onload=function(){e=!0,h()}):alert("Seleted file is not an image, please select another one.")}},drawImageOnCanvas:h,truncateColor:s,updateTextOnCanvas:function(){r.clearRect(0,0,n.width,n.height),o&&(r.putImageData(o,0,0),g(r,n.width,n.height,document.getElementById("slogan").value))},saveCanvas:function(){if(e){var t=function(){var t;if(n.msToBlob)t=n.msToBlob();else{for(var e=n.toDataURL("image/jpeg").split(","),a=e[0].match(/:(.*?);/)[1],i=atob(e[1]),o=i.length,r=new Uint8Array(o);o--;)r[o]=i.charCodeAt(o);t=new Blob([r],{type:a})}return t}(),a=(new Date).getTime(),i=document.createElement("a");if(n.msToBlob)window.navigator.msSaveBlob(t,"IT-poster-"+a+".jpg");else{var o=URL.createObjectURL(t);/CriOS/i.test(navigator.userAgent)&&/iphone|ipod|ipad/i.test(navigator.userAgent)?document.getElementById("not-supported").style.display="block":(document.body.appendChild(i),i.href=o,i.download="IT-poster-"+a+".jpg",i.click(),document.body.removeChild(i))}}}}};