var nikePosterGenerator=function(){var e=!0,t=!1,a=new Image,i=new Image;i.src="assets/images/just-do-it.svg";var o,n=document.getElementById("canvas"),h=n.getContext("2d",{alpha:!1}),r=function(){if(t){switch(document.getElementById("orientation").value){case"1":n.width=a.width,n.height=a.height,h.transform(1,0,0,1,0,0);break;case"2":n.width=a.height,n.height=a.width,h.transform(0,1,-1,0,a.height,0);break;case"3":n.width=a.width,n.height=a.height,h.transform(-1,0,0,-1,a.width,a.height);break;case"4":n.width=a.height,n.height=a.width,h.transform(0,-1,1,0,0,a.width);break;default:n.width=a.width,n.height=a.height,h.transform(1,0,0,1,0,0)}h.clearRect(0,0,n.width,n.height),h.drawImage(a,0,0),h.resetTransform(),h.globalCompositeOperation="saturation",h.fillStyle="hsl(0,0%,50%)",h.fillRect(0,0,n.width,n.height);var r=h.getImageData(0,0,n.width,n.height);r=d(r,document.getElementById("brightness").value,document.getElementById("contrast").value),h.putImageData(r,0,0),h.globalCompositeOperation="source-over",h.fillStyle="rgba(0, 0, 0, 0.5)",h.fillRect(0,0,n.width,n.height);var g=i.width/i.height,s=Math.floor(.03*n.width),c=s*g;h.drawImage(i,0,0,i.width,i.height,(n.width-c)/2,Math.floor(n.height-.06*n.height-s),c,s),o=h.getImageData(0,0,n.width,n.height),l(h,n.width,n.height,document.getElementById("slogan").value),e&&(document.getElementById("welcome").style.display="none",n.style.display="block",e=!1)}},l=function(e,t,a,i){var o=Math.floor(.07*t),n=Math.floor(t/2),h=Math.floor(a/2),r=Math.floor(.9*t),l=Math.floor(1.3*o),g=i.split(" "),d="",s=[];e.font=o+'px Times,"Times New Roman","Microsoft JhengHei","Heiti TC",sans-serif',e.textAlign="center",e.textBaseline="top",e.fillStyle="white";for(var c=0;c<g.length;c++){var m=d+g[c]+" ";e.measureText(m).width>r&&c>0?(s.push(d),d=g[c]+" "):d=m}s.push(d);var f=h-Math.floor(s.length*l/2);for(c=0;c<s.length;c++)e.fillText(s[c].trim(),n,f),f+=l},g=function(e){return e<0?0:e>255?255:e},d=function(e,t,a){for(var i=e.data,o=0;o<i.length;o+=4)i[o]=s(i[o],t),i[o]=c(i[o],a),i[o+1]=i[o],i[o+2]=i[o];return e.data=i,e},s=function(e,t){return e+t/100*255},c=function(e,t){return e=g(e*(t=t/100+1)+128*(1-t))};return{loadImage:function(){for(var e=document.getElementById("poster-source").files,i=0;i<e.length;i++){var o=e[i];o.type.match(/image.*/)?(a.src=URL.createObjectURL(o),a.onload=function(){t=!0,r()}):alert("Seleted file is not an image, please select another one.")}},drawImageOnCanvas:r,truncateColor:g,updateTextOnCanvas:function(){h.clearRect(0,0,n.width,n.height),o&&(h.putImageData(o,0,0),l(h,n.width,n.height,document.getElementById("slogan").value))},saveCanvas:function(){var e=function(){var e;if(n.msToBlob)e=n.msToBlob();else{for(var t=n.toDataURL("image/jpeg").split(","),a=t[0].match(/:(.*?);/)[1],i=atob(t[1]),o=i.length,h=new Uint8Array(o);o--;)h[o]=i.charCodeAt(o);e=new Blob([h],{type:a})}return e}();if(t){var a=(new Date).getTime(),i=document.createElement("a");n.msToBlob?window.navigator.msSaveBlob(e,"IT-poster-"+a+".jpg"):(document.body.appendChild(i),i.href=URL.createObjectURL(e),i.download="IT-poster-"+a+".jpg",i.click(),document.body.removeChild(i))}}}};